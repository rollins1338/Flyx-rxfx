const encoded = '=8Df6QXN7pHczZDSIhESVNFW2dVg9g0PBWnVptjesl1d1tjZ-kXN_5DP5VFWdhmWTxkbJ9DW51kbxNXNV5FV-AVbhtEe413PdFISwtlP-g2PK9EbrxleyF3VVdnTaZlPypjSNFmc61nWKhHfQhEe40HSQVFQuJHV8skV3w3Od9WedpTa7ZWX6dzdw13fPp0a-5XYmFFbqhUVf5UgJFYTyBkc4sUefdTWS1FSKBYaUB2Op1jXPJXa59UOrZlcut3aAxXfv9GgNBGQ0FYW98mc3AFVPxWa78FQ3dFbwtlSBi3TShEQ38Gg31HXoVzUbV1dgxkPhJVaahXbNtDSulEVK1TO5k0X-hESIhESIhESIBle78kN5tne1tma2Q4O9JYN5c3doZjNBp3d7t3bnkndn8Df6QXN5x2e6hGd2QDSIhUSy5Gb8kFU88ESttDYmlnX_ZnVmhFg_0jOwB0eSBlU8EHebFFbtJVbR1ndNl2P3AEUNJVY61jfzVleU5mVBGFUJVlcrZWWohEdetzSXt1bVllXU9lb4F1cN90dr9EVd12dvt0W38Tc1cnSyZ1eSZnc3gjbKRHcMh3ONVXbYB1S4hXShpUU8dFPqNVYvB3Obd1X4JVdsx2VVdjVaFWOAtXV2hkd7A3aadFb30TXUh0cZJHW99XPKVlZ9Y1UJpWa4YVSAdXSf11T3xGQoFFWThVVQ50f8tFgrRnW1lmbZ9UfJ93T_Y2e7d3SZpjP3cDdzpTOqpmOp1FSAimOUFYV5EVcYBkZ8tXet1mfMpFV-x0T3tEb7x2X31XXAK1eKZVTLx2XO1VSwxWT7gkbJRlS9kTOTpjfIhESIhESIhESQp3OPZzc3ZDh60ng1wTe7pHd7ZjNBp3d7t3bnkndn8Df6QXN5x2e6hGd2QDSIhUSy5Gb8kFU88ESttDYmlnX_ZnVmhFg_0jOwB0eSBlU8EHebFFbtJVbR1ndNl2P3AEUNJVY61jfzVleU5mVBGFUJVlcrZWWohEdetzSXt1bVllXU9lb4F1cN90dr9EVd12dvt0W38Tc1cnSyZ1eSZnc3gjbKRHcMh3ONVXbYB1S4hXShpUU8dFPqNVYvB3Obd1X4JVdsx2VVdjVaFWOAtXV2hkd7A3aadFb30TXUh0cZJHW99XPKVlZ9Y1UJpWa4YVSAdXSf11T3xGQoFFWThVVQ50f8tFgrRnW1lmbZ9UfJ93T_Y2e7d3SZpjP3cDdzpTOqpmOp1FSAimOUFYV5EVcYBkZ8tXet1mfMpFV-x0T3tEb7x2X31XXAK1eKZVTLx2XO1VSwxWT7gkbJRlS9kTOTpjfIhESIhESIhESQp3OPZzc3ZDh50ng1wTe7pHd7ZjNBp3d7t3bnkndn8Df6QXN5x2e6hGd2QDSIhUSy5Gb8kFU88ESttDYmlnX_ZnVmhFg_0jOwB0eSBlU8EHebFFbtJVbR1ndNl2P3AEUNJVY61jfzVleU5mVBGFUJVlcrZWWohEdetzSXt1bVllXU9lb4F1cN90dr9EVd12dvt0W38Tc1cnSyZ1eSZnc3gjbKRHcMh3ONVXbYB1S4hXShpUU8dFPqNVYvB3Obd1X4JVdsx2VVdjVaFWOAtXV2hkd7A3aadFb30TXUh0cZJHW99XPKVlZ9Y1UJpWa4YVSAdXSf11T3xGQoFFWThVVQ50f8tFgrRnW1lmbZ9UfJ93T_Y2e7d3SZpjP3cDdzpTOqpmOp1FSAimOUFYV5EVcYBkZ8tXet1mfMpFV-x0T3tEb7x2X31XXAK1eKZVTLx2XO1VSwxWT7gkbJRlS9kTOTpjfIhESIhESIhESQp3OPZzc3ZDh40ng1wTe7pHd7ZjNBp3d7t3bnkndn8Df6QXN5x2e6hGd2QDNIhESMhFW1AXf40zTuZmUeBHPAhTg48DXylHd_8HY69kfal1aVB0UvtjZ4UVO-ozb3hkbUFWcxdVT71FaORFa6o3UP9WUIx1XNhXNrlTg4Fmc7wGQ25mP_dTUapmPhdDeVlTUP9TOKRVc5MnbKhDYNFGgX1Fb7F1T7hzS8IVPL5VY6VHg4w1S-g3Sb9UPutUP0JXeQ1Ueh1jZKlXgQF1U9tzT6pFa1F3dM1mWJB1c4hDaztEY8BUP5UDWxxja9M1NYJHPf1nb0lEQ1MXeZpkaJp2a8dVfN1ja6pXdhpDfRFoTd1XW3AnWOhnUI91TJFVd84laTRlf6YXS_B2f_kGSsZWSJtmaOVze39DWZd1eSF1c-Q3fY9jS1kGY_x2XBGla_dzSACnXJB1SQhmOR5ET9lWawtjWyFlc6hGg-9jamxGOv9lZvRlWSp1dXFlZwJVbwxEVTBGf-8VUPp0eNdDSulEUKh3X-k0X-hESIhESIhESIBle78kNzdnNEqTfCWDP5tne0tnN2Eke3t3evdSe2dyP8pDd1kHb7pHa0ZDN0gESIxEWYVDc9hTPP5mZS5Fc8AEOBizPcJXe09zfgp3T-pVWrVFQT92OmhTV54jOvdHSuRVYxF3VNtXXo5EVopjeT90bRhEXf1Ee1sWOBiXYytDbAZnb-83NRpla-E2N4VVOR90P5oEVxlzcupEOg1UYAeVXstXUPtHOLxjU9skXhpXdAiDXL5DeLt1T942S9Qnc5BVT5FWPmpUeBCVUT13OPpnWoVXc3xUbalEUzhHOoN3SgxHQ9kTNYFHPq1zU3glc88VfuRXSAVzc5llSqlkarx3V91UPqpne1FmO8FVgO1VfZdDca5EeSh0XPlUU1xjXqNFV-pjdJ9HY_9TaIxmZJl0aq5UN7d3PYl1V7JVUz5Dd_h1PKVTag9HbfFYUq93NLBIcelEULBFa6ElTM1XapB3OaJXUypHaA63PqZGb482Xm9GVaJlW3dVUmBnUtBHTUNFY85zXR9kS710NI5WSQpEef5TSf5HSIhESIhESIhEU6tzT2M3d2QYO9JYN8k3e6R3e2YTQ6d3e792J5Z3J_wnO0VTestneoRnN0QDSIhETYhVNw1HO98kbmJlXwxDQ4EIO_wlc5R3P_BmeP5nWZtWVAN1b7YGOVljP682dI5GVhFXcX10edhmTUhmO6N1TvFFSc9VT4Vza5EIehJ3OsBkdu5zf3ElWq5TY3gXV5E1T_kjSUFXOz5mS4AWThB4Vdx2eR90e4sEPS1zSeFme1BIOctkP4t0WP1jbL1DdylHUNlXY9YmS5FIURNVf78keahWdxdHTtpVSQNHe4g2cLBGfA1TO1gVc8oWPTdDWyxzX95GdJBUNzlXWKpWSqtGfX1XT9ome6VXY6wXUB6UX9l1NwplT4JFSf9USRVHPep2UU5nO2l0fg93PphEbmlUSrpmT1s3d_gVWXtnURNnP09HW_oUNpB2fs9VgRp2f3sEgw5VSQtEUopTUOxUfplGc7olcRJneoBof_omZshzbfZ2bUplUad3VRZGcS1GcMR1UgxnPfF1TKtXT3gkbJBlS49lPJ9lfIhESIhESIhESQp3OPZzc3ZDh40ng1wTe7pHd7ZjNBp3d7t3bnkndn8Df6QXN5x2e6hGd2gESYh0b70WaUBIOthkUydHV4g2XB2TUZ9HOSZ3SXNXe9QVgdlEWfh1d1AlTXlVPu9jeXlkda1nZUNXUdh0fqpUf64HQUhWaBuzV4EFVS5UgUlVbOtkS48ETgpnZUpTa0x0balVgx1nUctmPTt3bfJHYc5WV4IXU8tVefRnV71latZXSb1FOUpDYeNHS3gzVW5DX5kkegNnS3kEW51kb21Uc6BndqB1XZxDf18Fee90f9AUb35TeJ9WTad1U8cze84Te45HgR90et9VOstWdTxDTV5Tc54na_AIS5BGaLB3dbBkV14WU6p1Pe5mV8hGY9EmPw1zUXplawx2Xc5nP1EVN6BEdxxzaAp2PAWXYrpmdh9lVOVnfBejXMVXgA5zWZp3dtt3ccFlc-QFUcp1OmBIWhhGPgF4Vzp0aNdDSulEUKh3X3k0X-hESIhESIhESIBle78kNzdnNEqTfCWDP5tne0tnN2Eke3t3evdSe2dyP8pDd1kHb7pHa0ZDSIhFSvtTbpRFg40GSSJ3dUhDafFYPRl1f4IldLd1c51DVB2VSY9FW3VDUOdVW942P6dVS2pVfmR1cR1FS_pmS9pjfARFapF4OXhTUUJlTBSVWt50SKhzTMBmemRlOpRHTvpVWBGXfSx1a-M1ev9lcgxlbVhjcRx3W59FdWtXXq1mdJtVX4QlOg51cIdDOXZlPclTS6B2cKdTSYlXTuZXTxpHc2pGUflFP8VzX451T_1DQtdnP5l0bNp1VTxzN7xjP5hnfAG1T712X5w2a1NFPMVlPxljfq9DgIlHYotEc3tFQWVjbRpnW_4lbWxHag1TY-AXPTdlWqBHbfxlf-UTU1oHQ0FHPrBka_AYdhtma2F2XW5Ud-F4NexUdBCkPblle312ezxVUy5DVQxlW7YGgYFGa8AWgXNnSr10NI5WSQpEefdTSf5HSIhESIhESIhEU6tzT2M3d2QYO9JYN8k3e6R3e2YTQ6d3e792J5Z3J_wnO0VTestneoRnNIhEWI92OtlGVAiTbIJlc3RFOo9Vg9EVW_hjU2t0VzlXPUFYXJh1XYdXNQ50VZ1jb_o3VJZnW9ZGVzFVXI9naK1nO-BEVolWg7cFORRlUOFIVZ1mTLpEOPxEY6ZGV6kGdM9mWZFYc9JFXr5zU792XyBGXuVFOyFFfbl3X0Z1edpWb2l0WdhDV6AmXzh0N4clV-wVOJpHYzp0NJhVeN5mdNFnewZnaQ9VW8wXNfhnXP9XPA12d-kXSv1kWXNFP3sHP-kHe-BYUPtXbflDbrV3U8wUV-EXO-p2PAiUegh2Swd3WAZVNuFlea9jXuZFfoBWPh5Dc9M1VapGcs9FX-5TNRVjeARXc8sGQq9Dg1F2aqZXYfZlT15Xg34FT1FIQ-sVW6dXb7NHXRJnPUBFXatjZAiVYoxDYBe1cKtWT3gkbJBlS491NJ9lfIhESIhESIhESQp3OPZzc3ZDh40ng1wTe7pHd7ZjNBp3d7t3b';

console.log('Testing URL-safe Base64 decode...');
console.log('Encoded length:', encoded.length);
console.log('First 50 chars:', encoded.substring(0, 50));

// Try URL-safe Base64 decode
function tryUrlSafeBase64(str) {
  try {
    // Remove leading = signs
    let cleaned = str.replace(/^=+/, '');
    
    // Replace URL-safe characters with standard Base64
    cleaned = cleaned.replace(/-/g, '+').replace(/_/g, '/');
    
    // Add padding if needed
    while (cleaned.length % 4 !== 0) {
      cleaned += '=';
    }
    
    const decoded = Buffer.from(cleaned, 'base64').toString('utf8');
    return decoded;
  } catch (err) {
    console.error('Decode error:', err.message);
    return null;
  }
}

const decoded = tryUrlSafeBase64(encoded);

if (decoded) {
  console.log('\n✓ Decoded successfully!');
  console.log('Decoded length:', decoded.length);
  console.log('First 200 chars:', decoded.substring(0, 200));
  
  if (decoded.includes('http')) {
    console.log('\n✓ Found HTTP!');
    const m3u8Match = decoded.match(/https?:\/\/[^\s"'<>]+\.m3u8[^\s"'<>]*/);
    if (m3u8Match) {
      console.log('\n✓✓✓ M3U8 URL FOUND:');
      console.log(m3u8Match[0]);
    }
  }
  
  // Check for placeholders
  if (decoded.includes('{v') || decoded.includes('{s')) {
    console.log('\n! Contains placeholders, need to resolve them');
    
    const cdnMappings = {
      '{v1}': 'shadowlandschronicles.com',
      '{v2}': 'shadowlandschronicles.net',
      '{v3}': 'shadowlandschronicles.io',
      '{v4}': 'shadowlandschronicles.org',
      '{s1}': 'com',
      '{s2}': 'net',
      '{s3}': 'io',
      '{s4}': 'org'
    };
    
    let resolved = decoded;
    for (const [placeholder, replacement] of Object.entries(cdnMappings)) {
      resolved = resolved.replace(new RegExp(placeholder.replace(/[{}]/g, '\\$&'), 'g'), replacement);
    }
    
    console.log('\nAfter placeholder resolution:');
    const m3u8Match = resolved.match(/https?:\/\/[^\s"'<>]+\.m3u8[^\s"'<>]*/);
    if (m3u8Match) {
      console.log('\n✓✓✓ FINAL M3U8 URL:');
      console.log(m3u8Match[0]);
    }
  }
} else {
  console.log('\n✗ Decode failed');
}
