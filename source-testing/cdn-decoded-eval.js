if(window.location.hostname==='cdn-live.tv' ){ const playlistUrl = 'https://edge.cdn-live-tv.ru/api/v1/channels/us-abc/index.m3u8?token=1f66ce5d8601e9e78b8d7418ee049bcfdd7a2db555c2f30e76293d98a28d2bf7.1766772785.4210e8756dcdd57fa61400d5a842cb9c.a4d8c8aa089a1b4f7ebfc1f88f3e1f13.e35a6468989493b60fe0d355d3411f7f.92a8921d4f557ba3'; const namePlayer = 'CDN Live TV'; const isFirstAttempt = true; const isPPVEvent = /us-(nfl-league-pass|nba-league-pass|nhl-league-pass|dazn-event|espn-event|paramount-event|peacock-event)-([1-9]|1[0-9]|20)/.test(playlistUrl); async function checkStreamStatus(url) { const controller = new AbortController(); const timeoutMs = isPPVEvent ? 5000 : 10000; const timeoutId = setTimeout(() => controller.abort(), timeoutMs); try { const response = await fetch(url, { method: 'HEAD', signal: controller.signal }); clearTimeout(timeoutId); return response.ok ? 200 : response.status; } catch (error) { clearTimeout(timeoutId); return 0; } } function refreshWithFirstZero() { let url = new URL(window.location.href); url.searchParams.set('first', '0'); window.location.href = url.toString(); } function showError(message, isReadyMessage = false) { const loading = document.getElementById('loading'); const titleText = isReadyMessage ? 'Ready' : 'Stream Error'; const onclickAction = isReadyMessage ? 'refreshWithFirstZero()' : 'location.reload()'; loading.innerHTML = ` <div style="text-align:center; max-width:90%;"> <h2 style="color:#ff0046; margin-bottom:20px;">${titleText}</h2> <p style="font-size:18px; margin:20px 0; color:#fff; line-height:1.5;">${message}</p> <button onclick="${onclickAction}" style=" background:#ff0046; color:white; border:none; padding:12px 28px; border-radius:5px; font-size:16px; cursor:pointer; font-weight:bold; transition:background 0.2s;"> Refresh Page </button> </div> `; loading.classList.remove('hidden'); } function initPlayer() { if (!window.OHls) { console.error('Плагин OHls недоступен.'); return; } const hlsConfiguration = { qualityControl: true, defaultQuality: 'max' }; const player = OPlayer.make('#player', { isLive: true, autoplay: true, muted: false, source: { src: playlistUrl, format: 'hls' } }).use([ OUI({ pictureInPicture: true, theme: { primaryColor: '#ff0046', progress: { position: 'top', mini: true }, controller: { slideToSeek: 'never', setting: { items: [{ name: 'Quality', default: 'Max', values: [], onChange: (value) => { const hls = player.plugins.hls.hls; const levels = hls.levels; const selectedLevel = levels.find(lvl => (lvl.height + 'p') === value); if (selectedLevel) hls.currentLevel = levels.indexOf(selectedLevel); } }] }, display: 'always', coverButton: true, displayBehavior: 'hover', time: false, buttons: { live: { text: namePlayer, position: 'right' } } } } }), window.OHls({ library: 'https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js', config: hlsConfiguration }), new OPlugin.AirPlay(), new OPlugin.Chromecast() ]).create(); player.on('loadedmetadata', () => { const hls = player.plugins.hls.hls; const levels = hls.levels; if (levels && levels.length > 0) { const highestQualityLevel = levels.reduce((a, b) => a.height > b.height ? a : b); hls.currentLevel = levels.indexOf(highestQualityLevel); const qualitySetting = player.context.ui.setting.items.find(i => i.name === 'Quality'); if (qualitySetting) { qualitySetting.values = levels.map(level => level.height + 'p').reverse(); qualitySetting.default = highestQualityLevel.height + 'p'; } } }); player.on('loadeddata', () => { const timeEl = document.querySelector('.css-17dq96f[aria-label="time"]'); if (timeEl) { timeEl.textContent = namePlayer; new MutationObserver(() => { if (timeEl.textContent !== namePlayer) timeEl.textContent = namePlayer; }).observe(timeEl, { childList: true, subtree: true }); } player.play().catch(() => { player.muted = true; player.play(); }); }); } async function startEverything() { const status = await checkStreamStatus(playlistUrl); if (status === 200) { initPlayer(); setTimeout(() => { const loading = document.getElementById('loading'); loading.classList.add('hidden'); setTimeout(() => loading.style.display = 'none', 500); }, 2000); } else { let message = 'Stream loading failed. Please refresh the page.'; let isReadyMessage = false; if (status === 404) { if (isPPVEvent) { message = 'This is a pay-per-view event. It will only be available once the event starts.'; } else { message = 'This channel is currently unavailable.'; } } else if (status === 403) { message = 'Refresh the page and try again.'; } else if (status === 0) { if (isPPVEvent) { message = 'This is a pay-per-view event. It will only be available once the event starts.'; } else { if (isFirstAttempt) { message = 'Channel ready to watch. Refresh the page.'; isReadyMessage = true; } else { message = 'Unable to connect to the stream server. Please try again later.'; } } } showError(message, isReadyMessage); } } window.addEventListener('load', startEverything); }